1
00:00:00,000 --> 00:00:06,440
In this lecture, we're going to talk about a very useful concept which we're going to

2
00:00:06,440 --> 00:00:13,080
use a lot throughout the bootcamp, and that is SSH, or Secure Shell.

3
00:00:13,080 --> 00:00:18,020
Now consider this, you have written a shell script and you want to copy it to another

4
00:00:18,020 --> 00:00:24,480
server to execute it there, or you want to copy it to 10 other servers at once.

5
00:00:24,480 --> 00:00:28,840
Or you have a new server configured and want to access it to install different software

6
00:00:28,840 --> 00:00:30,560
and run your application.

7
00:00:30,560 --> 00:00:35,860
The server may physically be in a different location, it may be in another country.

8
00:00:35,860 --> 00:00:41,200
So how do you access that server and configure stuff on its command line interface?

9
00:00:41,200 --> 00:00:44,480
Or how do you copy a script file and execute it there?

10
00:00:44,480 --> 00:00:47,600
Well that's what SSH is for.

11
00:00:47,600 --> 00:00:51,040
SSH again stands for Secure Shell.

12
00:00:51,040 --> 00:00:52,200
Why Secure?

13
00:00:52,200 --> 00:00:58,280
Because we're accessing a machine over the internet and we want to connect to it securely.

14
00:00:58,280 --> 00:01:03,480
Because it's our server and nobody else should be able to access it and do stuff there.

15
00:01:03,480 --> 00:01:08,160
That means we need to authenticate ourselves with the remote server.

16
00:01:08,160 --> 00:01:13,060
And there are two ways of authenticating with the remote server over SSH.

17
00:01:13,060 --> 00:01:15,680
The first one is username and password.

18
00:01:15,680 --> 00:01:23,160
And this is for the user registered or created on that remote server, not on your own laptop

19
00:01:23,160 --> 00:01:24,540
or computer.

20
00:01:24,540 --> 00:01:25,760
So how does that work?

21
00:01:26,240 --> 00:01:29,280
Let's say we have an application server running remotely.

22
00:01:29,280 --> 00:01:35,560
This could be a server in our company's own data center or this could be from cloud provider

23
00:01:35,560 --> 00:01:37,560
like AWS.

24
00:01:37,560 --> 00:01:42,280
Usually a server administrator will create a user or multiple users for different team

25
00:01:42,280 --> 00:01:49,200
members on that remote application server so that these users can all connect from their

26
00:01:49,200 --> 00:01:52,080
own machines, their own laptops.

27
00:01:52,080 --> 00:01:59,160
Now there is another way to connect to an authenticate with the remote server without

28
00:01:59,160 --> 00:02:07,880
typing password all the time and is actually even more secure than username password authentication.

29
00:02:07,880 --> 00:02:13,640
This is the second way of authenticating using SSH keys.

30
00:02:13,640 --> 00:02:15,080
How does this one work?

31
00:02:15,080 --> 00:02:21,960
The client machine connecting to the remote creates an SSH key pair which has a public

32
00:02:21,960 --> 00:02:23,800
and private keys.

33
00:02:23,800 --> 00:02:28,960
Keys are basically just encrypted values of random hashes.

34
00:02:28,960 --> 00:02:35,040
The private key of the pair is a secret key that only the client machine who created this

35
00:02:35,040 --> 00:02:37,400
key pair will have access to.

36
00:02:37,400 --> 00:02:42,480
So this key needs to be stored securely on that client machine, which is going to be

37
00:02:42,480 --> 00:02:47,040
your laptop, your computer and should not be shared with anyone else.

38
00:02:47,040 --> 00:02:53,080
The public key as the name suggests is public and can be shared with others, including our

39
00:02:53,080 --> 00:02:54,520
remote server.

40
00:02:54,520 --> 00:03:00,400
So by installing the public key on a remote server, we can tell the remote that the client

41
00:03:00,400 --> 00:03:06,840
machine that the public key belongs to is safe to connect to it or to allow connections

42
00:03:06,840 --> 00:03:07,840
from.

43
00:03:07,840 --> 00:03:13,800
The client can unlock the public key using its private key when it connects to the remote.

44
00:03:13,800 --> 00:03:18,560
So basically the combination of those two is required for the communication between the

45
00:03:18,560 --> 00:03:21,040
client and the remote server to happen.

46
00:03:21,040 --> 00:03:26,760
So in this case, each team member will create their own SSH key pair on their machine and

47
00:03:26,760 --> 00:03:34,760
then admin of the remote server administrator can then add the public SSH keys of all team

48
00:03:34,760 --> 00:03:37,320
members on that remote server.

49
00:03:37,320 --> 00:03:44,280
And after that, they can connect to the remote from their own machines by providing the SSH

50
00:03:44,280 --> 00:03:46,600
private key when connecting.

51
00:03:46,600 --> 00:03:52,280
And obviously, no one else whose public SSH key isn't registered on the remote server

52
00:03:52,280 --> 00:03:57,160
will be authorized to access that remote server.

53
00:03:57,160 --> 00:04:02,360
And that's why it's more secure.

54
00:04:02,360 --> 00:04:09,880
Now you can also add a user on the remote for another service, not just for team members.

55
00:04:09,880 --> 00:04:15,360
And this another service could be another application like Jenkins, which may also need to access

56
00:04:15,360 --> 00:04:22,920
the application server via SSH to copy files to or to execute some scripts there.

57
00:04:22,920 --> 00:04:30,240
So we can create a Jenkins user on the remote machine, then we can create an SSH key pair

58
00:04:30,240 --> 00:04:37,420
on the Jenkins machine and add the public SSH key of Jenkins to the authorized keys

59
00:04:37,420 --> 00:04:39,000
on application server.

60
00:04:39,000 --> 00:04:45,480
And this way we can allow Jenkins to automatically connect over SSH to our application server

61
00:04:45,480 --> 00:04:52,280
and then basically execute stuff on its command line interface.

62
00:04:52,280 --> 00:04:58,120
Now remember we said that whenever one machine wants to connect to another machine, the communication

63
00:04:58,120 --> 00:05:04,760
must be explicitly allowed through a firewall rule, otherwise all such communication is

64
00:05:04,760 --> 00:05:05,760
blocked.

65
00:05:05,760 --> 00:05:12,040
And just for clear understanding, the authentication is the step after we have connected to the

66
00:05:12,040 --> 00:05:13,200
machine.

67
00:05:13,200 --> 00:05:18,920
So first that connection must be allowed, and then the authentication will be verified

68
00:05:18,920 --> 00:05:20,000
by the server.

69
00:05:20,000 --> 00:05:26,960
Now we said that firewall always configures the specific port where the server is accessible.

70
00:05:26,960 --> 00:05:31,360
And that the port is always open for an application.

71
00:05:31,360 --> 00:05:37,800
So what port and which application is it that should run on the server to accept our SSH

72
00:05:37,800 --> 00:05:38,800
request?

73
00:05:38,800 --> 00:05:46,240
Well most operating systems will have an SSH service packaged in, which is already by default

74
00:05:46,240 --> 00:05:48,040
running on the machine.

75
00:05:48,040 --> 00:05:52,480
And the SSH service always runs on port 22.

76
00:05:52,480 --> 00:05:59,560
So we open port 22 on a server we want to connect to using SSH command.

77
00:05:59,560 --> 00:06:07,040
So this means that in the firewall rule we allow access to port 22 on the server we want

78
00:06:07,040 --> 00:06:09,600
to connect to via SSH.

79
00:06:09,600 --> 00:06:16,640
I also mentioned that in firewall rules you can configure the source or which devices

80
00:06:16,640 --> 00:06:19,600
from outside can access that machine.

81
00:06:19,600 --> 00:06:24,880
In case of a web application we said we want to allow everyone to access it and it's secure

82
00:06:24,880 --> 00:06:28,560
because they only have access to that one application.

83
00:06:28,560 --> 00:06:31,840
They can't access any other services on the machine.

84
00:06:31,840 --> 00:06:38,160
But SSH connection is very powerful because when you connect to another machine over SSH

85
00:06:38,160 --> 00:06:44,000
service you get access to the whole system and its command line interface.

86
00:06:44,000 --> 00:06:46,080
So you can do a lot of things there.

87
00:06:46,080 --> 00:06:51,840
So such connection should only be allowed for people who administer that server.

88
00:06:51,840 --> 00:06:59,940
So you can configure firewall rule for port 22 for specific wide listed IP addresses like

89
00:06:59,940 --> 00:07:05,400
your own machine's IP address or all server administrators IP addresses.

90
00:07:05,400 --> 00:07:11,360
So that's how SSH works and now let's see a simple example in action.

91
00:07:11,360 --> 00:07:16,440
In which we're going to create a remote server on a cloud platform.

92
00:07:16,440 --> 00:07:23,920
We're going to create an SSH key pair on our laptop to be able to log in without password

93
00:07:23,920 --> 00:07:30,800
and then we're going to copy a script file a very simple bash script to a remote server

94
00:07:30,800 --> 00:07:34,840
SSH into the server and execute the script file there.

95
00:07:34,840 --> 00:07:36,040
So let's do this.

96
00:07:36,040 --> 00:07:41,560
So as a first step we're going to create a virtual server on a cloud platform which

97
00:07:41,560 --> 00:07:47,640
is digital ocean and you're going to learn more about cloud platforms generally and how

98
00:07:47,640 --> 00:07:51,640
to work on digital ocean how to create servers etc.

99
00:07:51,640 --> 00:07:57,560
In the later module here I just want to simply create a server which is called the droplet

100
00:07:57,560 --> 00:08:01,480
in digital ocean and then connect to it via SSH.

101
00:08:01,480 --> 00:08:05,640
So just follow me on this one here it's actually pretty easy.

102
00:08:05,640 --> 00:08:08,160
We just click on create droplets.

103
00:08:08,160 --> 00:08:14,040
We start by selecting the region which is closest to you for me is going to be Frankfurt

104
00:08:14,040 --> 00:08:23,240
then we select an operating system like Ubuntu for example a regular SSD you can leave all

105
00:08:23,240 --> 00:08:30,520
the defaults as is and select the smallest server and here in the authentication section

106
00:08:30,520 --> 00:08:33,620
we're going to choose password authentication.

107
00:08:33,620 --> 00:08:38,860
So this is going to be the password that we're going to connect to the server.

108
00:08:38,860 --> 00:08:43,720
So as a first step we're not doing anything with the SSH keys and here just type the password

109
00:08:43,720 --> 00:08:49,160
that you want to create for the user and by default we're going to be given a root user

110
00:08:49,160 --> 00:08:54,020
so this is going to be root users password and I'm just going to type in a password here

111
00:08:54,020 --> 00:09:04,060
which has to meet those criteria.

112
00:09:04,060 --> 00:09:19,400
And that's it we don't select anything else just click on create

113
00:09:19,400 --> 00:09:27,040
and this will give us a server on digital ocean cloud platform that we can connect to.

114
00:09:27,040 --> 00:09:36,560
So this is our server let's call it a remote server and as you already know every server

115
00:09:36,560 --> 00:09:42,720
or every device on a network will have an IP address and our server here which we create

116
00:09:42,720 --> 00:09:47,740
on digital ocean platform will have a public facing IP address.

117
00:09:47,740 --> 00:09:52,940
So an IP address that we can directly connect to it and this is the address that we're going

118
00:09:52,940 --> 00:10:00,100
to need to connect to the server via SSH.

119
00:10:00,100 --> 00:10:07,100
So I'm going to copy this and now from our Linux computer or laptop whatever that is

120
00:10:07,100 --> 00:10:12,020
we're going to connect to this remote server how we're going to do that using an SSH command

121
00:10:12,020 --> 00:10:17,300
which is actually pretty simple we're just going to do SSH and then we're going to pass

122
00:10:17,300 --> 00:10:23,460
the user name which is the root as I said that's what we're given by default and then

123
00:10:23,460 --> 00:10:31,580
we need this character here the same character and the IP address or the host name of the

124
00:10:31,580 --> 00:10:37,940
remote server that we're connecting to which in our case was this IP address and that's

125
00:10:37,940 --> 00:10:43,700
it if I execute now it's just going to give us a prompt whether we want to connect to

126
00:10:43,700 --> 00:10:49,420
the server and basically confirm the authenticity of this remote server we're going to confirm

127
00:10:49,420 --> 00:10:55,020
this by tapping yes and now we have to provide the password right we have to authenticate

128
00:10:55,020 --> 00:11:00,140
with the server and the password is what we configured when creating the droplets so I'm

129
00:11:00,140 --> 00:11:11,700
going to type in that password enter and there you go so now within my own terminal I connected

130
00:11:11,700 --> 00:11:22,500
to the terminal of the remote server so this year what you see the prompt is different than

131
00:11:22,500 --> 00:11:28,540
what I had here so the first one again you know the prompt composition the first one

132
00:11:28,540 --> 00:11:37,620
is the username of the machine which is root user and this is the name of the machine our

133
00:11:37,620 --> 00:11:44,140
machine's name was Nana Ubuntu and this is the name of the remote server we are in the

134
00:11:44,140 --> 00:11:51,900
home directory of the root user so if I do pwd you see slash root so basically we just

135
00:11:51,900 --> 00:11:58,740
connected to a remote machine from our local machine using the username password authentication

136
00:11:58,740 --> 00:12:06,820
no SSH keys used yet and since we are in the terminal of that remote server we can do stuff

137
00:12:06,860 --> 00:12:14,780
here like we can install applications right we can do apt install whatever application we want

138
00:12:14,780 --> 00:12:22,460
but our goal is to be able to connect to the server without the password and for that we

139
00:12:22,460 --> 00:12:31,180
need to configure the SSH key pair so I'm gonna open a new terminal here so we're gonna stay in

140
00:12:31,180 --> 00:12:41,540
the servers terminal and here we have our own so first of all in my users home directory we can

141
00:12:41,540 --> 00:12:49,060
check whether there is a dot SSH folder and you see that there is and that was created actually

142
00:12:49,060 --> 00:12:59,020
when we confirm that prompt of the host authenticity which was stored here and now using an SSH

143
00:12:59,620 --> 00:13:07,340
sub-command we're gonna create the SSH key pair which is also super simple I'm just gonna do SSH

144
00:13:07,340 --> 00:13:19,660
key gen or key generation and provide a flag here for an option RSA so what is this option that's

145
00:13:19,660 --> 00:13:26,340
the type of the key pair that we're creating and this value here is actually the cryptographic

146
00:13:26,380 --> 00:13:33,860
algorithm that is used to encrypt those keys we have about three four different values one of the

147
00:13:33,860 --> 00:13:39,900
common ones is RSA that's what we are choosing here but again we don't have to know how these keys

148
00:13:39,900 --> 00:13:45,460
are encrypted and created in detail we just want to create them and be able to use them so I'm gonna

149
00:13:45,460 --> 00:13:53,460
click okay and we have a couple of configuration options here first of all where to save the key

150
00:13:53,780 --> 00:14:01,300
by default the dot SSH folder is the default location so we just confirm it we just say

151
00:14:01,940 --> 00:14:09,700
enter we can additionally secure our key pair by a passphrase so even though we're not gonna need

152
00:14:09,700 --> 00:14:17,700
a password when we connect to the remote we may add ourselves passphrase which is same as password

153
00:14:17,700 --> 00:14:24,980
for additional security I usually leave this empty so no passphrase needed and there you go that

154
00:14:24,980 --> 00:14:36,020
was it we have the key pair created this is just an output and now if we go to dot SSH folder and

155
00:14:36,020 --> 00:14:45,460
print the contents right here we have our SSH key pair we have the public key with dot pub extension

156
00:14:45,460 --> 00:14:51,060
and we have the private key so this is the private one and as I said the private one stays on the

157
00:14:51,060 --> 00:14:56,980
computer we don't share it with anyone and the public key can be shared with a remote server

158
00:14:57,700 --> 00:15:08,500
which we want to connect to now how do we put this public key into the remote server so that we

159
00:15:08,500 --> 00:15:15,700
can connect to it using the SSH key that's also pretty simple actually because on this server we

160
00:15:15,700 --> 00:15:22,900
also have dot SSH folder or we can create if we don't have that and in our case we have authorized

161
00:15:22,900 --> 00:15:31,780
keys let's actually print out what's inside and you see it's empty and that's the file the authorized

162
00:15:31,780 --> 00:15:40,980
keys is the file where we add the public key of all the computers all the client

163
00:15:41,700 --> 00:15:47,380
computers that want to connect to this server so this is a list of public keys basically

164
00:15:48,660 --> 00:15:52,020
so so I'm going to open this authorized keys file

165
00:15:52,180 --> 00:16:02,100
using the vim editor and then I'm just gonna copy whatever is inside the public key

166
00:16:04,580 --> 00:16:13,860
and we have to do like this I'm gonna copy all this the whole thing and I'm gonna paste it in

167
00:16:13,860 --> 00:16:22,740
here again this is my computers or my virtual boxes environment this is my nano user where

168
00:16:22,740 --> 00:16:30,820
we created the key pair and this is the public key contents which I am copying and pasting

169
00:16:31,620 --> 00:16:38,900
inside the remote servers authorized keys file right and if you have multiple people connecting

170
00:16:38,900 --> 00:16:46,500
to the server you can add these public keys as a list here so let's save this and note that we

171
00:16:46,500 --> 00:16:53,620
don't have to use sudo for any of these because we are a root user awesome so we have that configured

172
00:16:54,340 --> 00:17:05,780
now I'm gonna exit from this server and this will push us back to our machine and now let's try to

173
00:17:05,780 --> 00:17:13,220
connect to the host again the same comment remember the last time we had to provide a password

174
00:17:13,220 --> 00:17:20,660
now let's see what happens and there you go we didn't have to provide a password because the

175
00:17:20,660 --> 00:17:28,260
private key was used to authenticate with the server because we added our public key in the

176
00:17:28,260 --> 00:17:33,460
authorized keys file also so that the prompt that we got the first time also didn't come

177
00:17:34,100 --> 00:17:43,460
because that server IP address this one here is already in the known hosts file

178
00:17:45,300 --> 00:17:55,380
now let's actually go back again to our computer using exit and look at this ssh command that we

179
00:17:56,100 --> 00:18:02,900
executed to connect to the remote server and you see here that we haven't provided the private key

180
00:18:04,100 --> 00:18:11,140
in the command options we just said ssh username on the remote server and the IP address of the

181
00:18:11,140 --> 00:18:19,380
remote server so how does it know which private key to use or where to find it well the dot ssh

182
00:18:23,620 --> 00:18:24,100
id

183
00:18:24,660 --> 00:18:35,220
rsa is actually the default location where the ssh command will look for the private key

184
00:18:35,220 --> 00:18:40,340
and that means if you have multiple key pairs in dot ssh folder and your private key is called

185
00:18:40,340 --> 00:18:46,660
id rsa2 or something else then you have to provide that explicitly because

186
00:18:47,620 --> 00:18:56,740
the default location will not be correct so this command here is actually equivalent of

187
00:18:57,460 --> 00:19:05,620
this year so the same command but with an option of passing the private key in the ssh

188
00:19:05,620 --> 00:19:11,700
command right by specifying the location of the private key so as i said if you have multiple

189
00:19:11,700 --> 00:19:19,300
key pairs and for this server you're using a private key with the name of id rsa2 then you

190
00:19:19,300 --> 00:19:27,860
have to provide that explicitly like this so let's actually try to execute this and see what happens

191
00:19:27,860 --> 00:19:36,820
there you go we connected successfully awesome so as a final step we want to create a simple

192
00:19:36,820 --> 00:19:44,020
script file on our local computer and then copy that to the remote and execute it there so again

193
00:19:44,020 --> 00:19:53,780
let's exit switching back and forth between our local and the remote servers and the remote machines

194
00:19:54,660 --> 00:20:00,020
so i'm going to create a very simple script here um let's call it test dot ssh

195
00:20:00,340 --> 00:20:17,940
the shebang line like this and let's just echo something i am executed on the remote server

196
00:20:21,060 --> 00:20:28,580
so let's save this and using just one simple command we can actually now copy this file

197
00:20:29,540 --> 00:20:36,020
from our local machine to the remote and for that we have a command called scp

198
00:20:36,660 --> 00:20:44,740
which stands for secure copy and we just need the source and the target source is test.sh file

199
00:20:45,460 --> 00:20:51,380
and the target is our remote server so just like we specified it for the ssh command we're

200
00:20:51,380 --> 00:20:56,900
specifying the same way for scp command the username of the remote server

201
00:20:59,060 --> 00:21:06,820
the ip address and finally we actually need the path or location of the directory where this

202
00:21:06,820 --> 00:21:13,940
file will be copied on the remote right and we can copy this in the root user's home directory

203
00:21:14,580 --> 00:21:23,300
like this and let's execute and you see we have an output that 100 percent of that was copied

204
00:21:23,860 --> 00:21:31,780
and by the way this command also takes the private key as a parameter but the default is

205
00:21:31,780 --> 00:21:38,980
dot ssh id underscore rsa that's why we don't have to provide it here however this will be equivalent

206
00:21:38,980 --> 00:21:49,300
of this as well so this is the same exact command again if you are using a different

207
00:21:49,940 --> 00:21:55,380
private key name or it's in a different location then you have to explicitly provide it here

208
00:21:56,180 --> 00:22:01,620
so now that we've copied the file on the remote let's actually enter it again or ssh and

209
00:22:02,500 --> 00:22:08,340
execute that file so let's execute our ssh command again

210
00:22:08,820 --> 00:22:19,620
and now if i do ls on this remote right here we have task.sh file and let's

211
00:22:20,820 --> 00:22:26,820
check the permissions and you see that we don't have executable permissions so we have to edit

212
00:22:28,420 --> 00:22:31,860
change mod let's add it to the root user

213
00:22:32,420 --> 00:22:45,060
task.sh and there you go now let's just execute and there we have it

214
00:22:48,420 --> 00:22:55,860
so that's all you need to know about ssh and how to use it as i said we are going to be using ssh

215
00:22:56,420 --> 00:23:02,660
a lot throughout the bootcamp since we're going to be creating servers on the cloud

216
00:23:02,660 --> 00:23:09,700
to run applications there because as a devops engineer you do a lot of stuff on servers so you

217
00:23:09,700 --> 00:23:16,500
will have a plenty of possibilities throughout the bootcamp to practice your ssh skills and one

218
00:23:16,500 --> 00:23:22,820
thing that you may be already asking yourself is we didn't actually configure a firewall rule to

219
00:23:22,900 --> 00:23:30,180
access our server on digital ocean and the reason for that is that by default when we create servers

220
00:23:30,180 --> 00:23:37,940
here everything or all the ports are open so we can access the server or any application on any

221
00:23:37,940 --> 00:23:44,820
port on the server by default that's how it's configured however we have of course a possibility

222
00:23:44,820 --> 00:23:52,420
to create a firewall configuration and then assign it to our server and block all the ports

223
00:23:52,420 --> 00:23:59,860
and just open the ones that we want to be accessing and you can do that all in the UI here

224
00:23:59,860 --> 00:24:05,780
and we're going to learn all of these and how to configure firewall in the cloud basics module

225
00:24:05,780 --> 00:24:11,780
and also once you're done with the server you can just delete it so that you don't have any costs

226
00:24:11,780 --> 00:24:27,700
here by just going to droplets and then doing destroy and there you go

