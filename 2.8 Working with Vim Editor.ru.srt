1
00:00:00,000 --> 00:00:10,000
В этой лекции мы научимся пользоваться очень быстрым и эффективным текстовым редактором Unix под названием VIM, VIM.

2
00:00:10,000 --> 00:00:19,000
Это текстовый редактор, которым мы пользуемся в интерфейсе командной строки и который очень быстрый и эффективный в работе, когда вы научитесь его использовать.

3
00:00:19,000 --> 00:00:24,000
Сначала я объясню, зачем он нужен, и каковы основные преимущества использования VIM.

4
00:00:24,000 --> 00:00:30,000
Затем перейдём к практической части и узнаем, как работать с редактором VIM.

5
00:00:32,000 --> 00:00:42,000
Мы видели, как создавать файлы, как их переименовывать и копировать, а также как выводить содержимое файла в интерфейсе командной строки.

6
00:00:42,000 --> 00:00:46,000
Теперь как записывать в файл из командной строки?

7
00:00:46,000 --> 00:00:51,000
Это вообще возможно, ведь у нас здесь нет текстового редактора, верно?

8
00:00:51,000 --> 00:01:04,000
На самом деле в командной строке Linux есть встроенный текстовый редактор VI или его более богатая, современная версия под названием VIM, VIM.

9
00:01:04,000 --> 00:01:13,000
Этот редактор входит в состав большинства дистрибутивов Linux, и вы можете писать в нём так же, как в обычном текстовом редакторе.

10
00:01:13,000 --> 00:01:25,000
Однако, поскольку он встроен в интерфейс командной строки, вам нужно знать специальные команды редактора VI, чтобы перемещаться внутри редактора и работать с файлами.

11
00:01:25,000 --> 00:01:36,000
Теперь вы можете подумать, зачем мне использовать редактор в интерфейсе командной строки, ведь визуальные текстовые редакторы намного приятнее и удобнее.

12
00:01:36,000 --> 00:01:39,000
На самом деле для этого есть хорошие варианты применения.

13
00:01:39,000 --> 00:01:50,000
Во-первых, вам может понадобиться быстро отредактировать файл, например конфигурационный, где нужно просто закомментировать что-то или поправить значение.

14
00:01:50,000 --> 00:02:03,000
То есть нужно внести очень небольшое изменение в файл, и на самом деле быстрее сделать это в интерфейсе командной строки, чем открывать какой-то редактор, искать там этот файл и вносить изменения.

15
00:02:03,000 --> 00:02:22,000
Также, если вы хотите создать файл в текущем каталоге и просто записать в него, можно быстро создать файл и открыть его через редактор VI или VIM вместо перехода в папку и создания файла в графическом редакторе и т.д.

16
00:02:22,000 --> 00:02:37,000
VIM также поддерживает открытие всех типов форматов файлов, и, наконец, ещё одно важное преимущество использования VIM — иногда вам нужно редактировать файл на системе, где нет визуального текстового редактора, и VIM — единственный доступный вариант.

17
00:02:37,000 --> 00:02:45,000
Классический пример — работа на удалённом сервере, где у вас есть только интерфейс командной строки этого сервера.

18
00:02:45,000 --> 00:02:57,000
Я лично использую его для пары разных сценариев: при работе с Git в интерфейсе командной строки просто пишу сообщение коммита через текстовый редактор VI.

19
00:02:57,000 --> 00:03:08,000
Также я использую его, чтобы просматривать конфигурационные файлы Kubernetes — например, проверить, что они корректны, или что-то найти, вместо того чтобы открывать это в графическом редакторе.

20
00:03:08,000 --> 00:03:15,000
Это гораздо быстрее, особенно если я уже работаю в интерфейсе командной строки, выполняя какие-то команды Kubernetes.

21
00:03:15,000 --> 00:03:27,000
И третий типичный сценарий, где я использую редактор VI или VIM, — когда нужно изменить конфигурационный файл какого-нибудь приложения, где надо исправить всего одну строку или слово.

22
00:03:27,000 --> 00:03:32,000
Снова-таки быстрее открыть его прямо в интерфейсе командной строки.

23
00:03:33,000 --> 00:03:50,000
Однако, поскольку он встроен в интерфейс командной строки, вам нужно знать команды редактора VI или VIM, чтобы перемещаться по редактору и содержимому файла и работать с файлами.

24
00:03:50,000 --> 00:03:56,000
По умолчанию редактор VI поставляется вместе с операционной системой.

25
00:03:56,000 --> 00:04:00,000
Однако, как я упомянул, у нас нет редактора VIM.

26
00:04:00,000 --> 00:04:11,000
Поэтому нам нужно его установить, и чтобы проверить, можно просто попытаться выполнить beam или VIM с именем файла — не важно каким.

27
00:04:11,000 --> 00:04:21,000
Например, Test.txt, текстовый файл, и вы увидите, что команда не найдена.

28
00:04:21,000 --> 00:04:31,000
Поэтому мы установим редактор VIM с помощью нашего менеджера пакетов вот так.

29
00:04:31,000 --> 00:04:35,000
Теперь мы можем им пользоваться и посмотреть, как он работает.

30
00:04:35,000 --> 00:04:46,000
Сначала давайте перейдём в папку documents Java app, где у нас есть существующий файл readme в формате markdown.

31
00:04:46,000 --> 00:04:53,000
С VIM вы можете открывать существующие файлы с любым расширением.

32
00:04:53,000 --> 00:04:57,000
Это может быть Python-файл, Java-файл, простой конфигурационный файл.

33
00:04:57,000 --> 00:05:01,000
Это не имеет значения — VIM позволяет открывать самые разные файлы.

34
00:05:01,000 --> 00:05:06,000
Для этого вводим команду VIM, а затем имя файла.

35
00:05:06,000 --> 00:05:10,000
И, нажав Enter, вы видите здесь содержимое файла.

36
00:05:10,000 --> 00:05:13,000
Редактор VIM имеет два режима.

37
00:05:13,000 --> 00:05:17,000
Первый — режим по умолчанию, который вы видите прямо сейчас.

38
00:05:17,000 --> 00:05:23,000
В этот режим вы попадаете автоматически при открытии файла, и он называется режимом команд.

39
00:05:23,000 --> 00:05:30,000
В режиме команд вы не можете печатать здесь текст, но можете делать всё остальное.

40
00:05:30,000 --> 00:05:40,000
Вы можете перемещаться по содержимому, создавать новые строки, удалять строки, искать в файле, отменять изменения и так далее.

41
00:05:40,000 --> 00:05:44,000
Второй режим называется режимом редактирования или вставки.

42
00:05:44,000 --> 00:05:48,000
В этом режиме вы можете вводить символы и редактировать текст.

43
00:05:48,000 --> 00:05:58,000
То есть перемещаетесь внутри файла в режиме команд, а вводите символы или правите текст в режиме вставки, поэтому вам часто придётся переключаться туда-сюда.

44
00:05:58,000 --> 00:06:11,000
Чтобы перейти из режима команд в режим редактирования, нужно нажать I (insert), и вы увидите, что здесь активирован режим вставки.

45
00:06:11,000 --> 00:06:17,000
Так вы понимаете, в каком режиме находитесь, и теперь можете начинать что-то вводить.

46
00:06:18,000 --> 00:06:21,000
И так далее.

47
00:06:21,000 --> 00:06:27,000
То есть вы просто редактируете файл, и сейчас мы в режиме вставки.

48
00:06:27,000 --> 00:06:36,000
Когда закончите вносить изменения или редактировать файл, вы захотите закрыть редактор и сохранить сделанные изменения.

49
00:06:36,000 --> 00:06:42,000
Для этого нужно вернуться в режим команд, и делается это клавишей Escape.

50
00:06:42,000 --> 00:06:47,000
Просто нажмите здесь Escape, и вы снова в режиме команд.

51
00:06:47,000 --> 00:06:58,000
И чтобы сохранить файл и закрыть его, вы бы набрали двоеточие, которое видно здесь, а затем write quit.

52
00:06:58,000 --> 00:07:04,000
И если я нажму Enter, видно, что файл был закрыт, то есть редактор закрылся.

53
00:07:04,000 --> 00:07:13,000
А теперь, если мы отобразим или выведем содержимое readme, то увидим наши изменения.

54
00:07:13,000 --> 00:07:21,000
Теперь вернёмся в файл, перейдём в режим вставки и сделаем ещё пару изменений.

55
00:07:35,000 --> 00:07:38,000
Я просто пишу здесь какой‑то текст, это не важно.

56
00:07:38,000 --> 00:07:44,000
Но допустим, в какой‑то момент вы решаете, что не хотите сохранять внесённые изменения.

57
00:07:44,000 --> 00:07:48,000
Вы хотите закрыть файл и фактически отбросить изменения.

58
00:07:48,000 --> 00:07:58,000
Снова нажимаете Escape, чтобы вернуться в командный режим, и вместо write и quit вводите просто quit, а затем восклицательный знак.

59
00:07:58,000 --> 00:08:04,000
И это фактически отбросит изменения и закроет файл.

60
00:08:04,000 --> 00:08:13,000
И если мы снова выведем содержимое файла, видно, что изменение не сохранилось.

61
00:08:13,000 --> 00:08:22,000
Итак, это две команды, которые вам всегда понадобятся при работе в редакторе vim, потому что либо вы меняете что‑то в файле

62
00:08:22,000 --> 00:08:27,000
и хотите сохранить, либо хотите отменить и закрыть редактор.

63
00:08:27,000 --> 00:08:31,000
Так что их нужно потренировать и запомнить наизусть, эти две команды.

64
00:08:31,000 --> 00:08:39,000
Кроме того, есть всего несколько полезных команд, которые стоит выучить, чтобы пользоваться vim.

65
00:08:39,000 --> 00:08:47,000
Это примерно 10 команд, и если вы их выучите, сможете свободно перемещаться по редактору vim

66
00:08:47,000 --> 00:08:50,000
и фактически делать внутри что угодно.

67
00:08:50,000 --> 00:08:55,000
Здесь нет ничего сложного, всего пара других команд.

68
00:08:55,000 --> 00:08:59,000
Сейчас мы редактировали существующий файл в vim.

69
00:08:59,000 --> 00:09:03,000
Однако мы можем также создавать новые файлы редактором vim.

70
00:09:03,000 --> 00:09:09,000
Для этого просто набираете vim и имя нового файла, который хотите создать.

71
00:09:09,000 --> 00:09:17,000
Назовём его config.yaml — опять же, может быть любого формата.

72
00:09:17,000 --> 00:09:21,000
И если нажать, видно, что был создан новый файл.

73
00:09:21,000 --> 00:09:27,000
Вот здесь видно, и он также открылся в командном режиме по умолчанию.

74
00:09:27,000 --> 00:09:31,000
Так что теперь можно снова начинать редактировать и печатать здесь.

75
00:09:31,000 --> 00:09:35,000
Я собираюсь вставить сюда содержимое из другого файла.

76
00:09:35,000 --> 00:09:41,000
Во‑первых, вы видите красивую подсветку синтаксиса, которую даёт редактор командной строки, что очень круто.

77
00:09:41,000 --> 00:09:45,000
И теперь мы можем выучить пару полезных команд на примере этого файла.

78
00:09:45,000 --> 00:09:51,000
Это пример конфигурационного файла Kubernetes, но это не важно — мог быть любой файл.

79
00:09:51,000 --> 00:09:53,000
Это мог быть и текстовый файл.

80
00:09:53,000 --> 00:10:00,000
Во‑первых, если вы хотите удалить строки в редакторе vim — допустим, хотим удалить эту строку прямо здесь.

81
00:10:00,000 --> 00:10:10,000
Вместо того чтобы удалять символ за символом, можно удалить всю строку в командном режиме.

82
00:10:10,000 --> 00:10:17,000
Для этого сначала переключаемся в командный режим клавишей Escape и затем набираем два раза d.

83
00:10:17,000 --> 00:10:21,000
Итак, dd — и это уберёт всю строку.

84
00:10:21,000 --> 00:10:25,000
Можно удалять и несколько строк сразу.

85
00:10:25,000 --> 00:10:33,000
Например, у вас огромный конфигурационный код, и вы нашли часть, которая совсем не нужна.

86
00:10:33,000 --> 00:10:37,000
И это, скажем, 10 строк, и вы хотите удалить все эти 10 строк сразу.

87
00:10:37,000 --> 00:10:44,000
Вы можете сделать это очень просто, набрав d, затем 10,

88
00:10:44,000 --> 00:10:49,000
а затем снова d — и это удалит 10 строк.

89
00:10:49,000 --> 00:10:57,000
Теперь представим, вы удалили 10 строк и поняли, что эта конфигурация всё же нужна, и хотите отменить изменение.

90
00:10:57,000 --> 00:11:02,000
Для этого просто нажимаете u, и это отменит изменения.

91
00:11:02,000 --> 00:11:10,000
И если вы хотите отменить предыдущее изменение тоже, снова нажимаете u, и оно отменит оба изменения.

92
00:11:10,000 --> 00:11:14,000
И снова обратите внимание, что для всего этого мы находимся в командном режиме.

93
00:11:14,000 --> 00:11:17,000
Именно там выполняются все команды.

94
00:11:17,000 --> 00:11:23,000
Другие полезные клавиши: переход в конец строки.

95
00:11:23,000 --> 00:11:32,000
Допустим, хотим отредактировать этот container port, и чтобы сразу прыгнуть в конец строки, вместо того чтобы идти туда стрелками.

96
00:11:32,000 --> 00:11:36,000
Просто введите большую A, то есть Shift+A.

97
00:11:36,000 --> 00:11:42,000
И это отправит вас в конец строки и также переключит в режим вставки.

98
00:11:42,000 --> 00:11:45,000
Так что теперь мы можем просто печатать здесь.

99
00:11:45,000 --> 00:11:54,000
Давайте вернёмся в командный режим, и так же можно прыгнуть в начало строки, набрав ноль.

100
00:11:54,000 --> 00:11:59,000
Итак, перешли в начало строки, и мы всё ещё в командном режиме.

101
00:11:59,000 --> 00:12:10,000
Мы также можем перейти к концу строки или прыгнуть в конец строки без перехода в режим вставки, набрав доллар как здесь.

102
00:12:10,000 --> 00:12:22,000
Так что, используя ноль и знак доллара, вы можете перемещаться по файлу и довольно быстро попадать куда нужно вот так.

103
00:12:22,000 --> 00:12:32,000
И последняя команда, очень удобная для навигации по файлу, — прыжок на конкретную строку внутри файла.

104
00:12:32,000 --> 00:12:40,000
Допустим, у вас есть файл из 100 строк кода или конфигурации, и вы получаете ошибку, что на строке 12 есть проблема.

105
00:12:40,000 --> 00:12:50,000
Вы хотите прыгнуть прямо на эту строку, и это можно сделать, набрав номер строки, например 12, а затем заглавную G.

106
00:12:50,000 --> 00:12:58,000
То есть Shift+G, и вы сразу перейдёте на 12-ю строку вашего конфигурационного файла.

107
00:12:58,000 --> 00:13:03,000
Теперь давайте прыгнем на строку 16 — пожалуйста.

108
00:13:03,000 --> 00:13:10,000
Эти команды, которые я показал, — базовые команды, необходимые для навигации по файлу.

109
00:13:10,000 --> 00:13:21,000
И если вы их выучите и будете часто использовать, вы будете быстро работать с ними и обнаружите, что очень легко писать и редактировать файлы в редакторе Vim.

110
00:13:21,000 --> 00:13:36,000
И ещё две команды, которые я хочу показать, — они очень практичны, когда вы ищете что-то в файле или хотите заменить все вхождения определённого слова или строки в файле.

111
00:13:36,000 --> 00:13:47,000
Первая команда — для поиска в файле, и для этого в командном режиме нужно набрать слэш, и вы увидите курсор вот здесь.

112
00:13:47,000 --> 00:13:52,000
И здесь вы можете ввести любой текст, который ищете.

113
00:13:52,000 --> 00:13:57,000
Допустим, мы ищем все места, где написано nginx.

114
00:13:57,000 --> 00:14:10,000
Он найдёт первое совпадение для этой поисковой строки, так сказать, и теперь вы можете перейти к следующему совпадению вот так.

115
00:14:10,000 --> 00:14:16,000
Или можно перейти к предыдущему совпадению, используя заглавную N.

116
00:14:16,000 --> 00:14:23,000
То есть Shift+N вернёт к предыдущему вхождению искомого слова.

117
00:14:23,000 --> 00:14:35,000
Снова это особенно полезно, если у вас огромный конфигурационный файл или, может быть, лог, где вы ищете конкретное значение, так что можно искать это значение через слэш.

118
00:14:35,000 --> 00:14:44,000
И ещё один интересный сценарий — если вы хотите заменить определённое слово во всех местах в файле.

119
00:14:44,000 --> 00:14:50,000
Допустим, мы хотим переименовать это приложение из nginx в web app.

120
00:14:50,000 --> 00:14:56,000
Но поскольку nginx встречается здесь пять раз, мы не хотим делать это вручную по одному.

121
00:14:56,000 --> 00:15:00,000
Мы хотим написать команду, которая заменит все вхождения nginx.

122
00:15:00,000 --> 00:15:07,000
Чтобы заменить строку на новую, мы набираем двоеточие, процент, s.

123
00:15:07,000 --> 00:15:16,000
То есть мы фактически заменяем строку, и нам нужна исходная строка, которую заменяем, и новая, вот так.

124
00:15:16,000 --> 00:15:24,000
И если я нажму Enter, вы увидите, что все вхождения nginx сменились на web app.

125
00:15:24,000 --> 00:15:28,000
И у меня также есть такая мини-сводка вот здесь.

126
00:15:28,000 --> 00:15:34,000
И снова, если я хочу отменить изменения, я просто нажимаю u — и готово.

127
00:15:34,000 --> 00:15:52,000
Итак, это, по сути, все команды, которые нужно знать, чтобы комфортно пользоваться редактором Vim и эффективно работать с файлами.

128
00:15:52,000 --> 00:16:01,000
Для закрепления: вы увидели, что можем переключаться в режим вставки и начать печатать здесь что угодно.

129
00:16:01,000 --> 00:16:14,000
Мы можем вернуться в командный режим и делать всякое вроде удаления строки или отмены изменений, можем удалять несколько строк сразу.

130
00:16:14,000 --> 00:16:21,000
Мы можем прыгать в конец строки, а также в начало строки одной командой.

131
00:16:21,000 --> 00:16:29,000
И вы также увидели, что можем искать конкретное значение в файле и заменять его новой строкой во всех местах использования.

132
00:16:29,000 --> 00:16:40,000
И снова, если я хочу сохранить изменения и закрыть файл в командном режиме, я просто набираю двоеточие write quit — и всё.

133
00:16:40,000 --> 00:16:47,000
Советую практиковать эти команды, чтобы вам было комфортно их использовать и вы их запомнили.

134
00:16:47,000 --> 00:16:53,000
И для простых задач начинайте пользоваться редактором Vim, чтобы практиковаться ещё больше.

