1
00:00:00,000 --> 00:00:18,620
Теперь скажем, я уберу эту одну строку здесь и здесь просто поменяю код, верно?

2
00:00:18,620 --> 00:00:29,680
Итак, мы вносим эти изменения, я их добавляю и коммичу, удаляю несколько строк логов.

3
00:00:29,680 --> 00:00:33,800
Теперь у меня есть коммит, который нужно запушить в удалённый репозиторий, верно?

4
00:00:33,800 --> 00:00:37,760
У меня коммит локально, удалённый репозиторий об этом не знает.

5
00:00:37,760 --> 00:00:44,520
Теперь перед тем как пушить, допустим, я понял, что изменение, которое я сделал, было неправильным.

6
00:00:44,520 --> 00:00:49,880
Так что я хочу откатить изменение и хочу откатить весь коммит.

7
00:00:49,880 --> 00:00:55,640
Поскольку он только локально и не в удалённом репозитории, так как никто другой его не проверил

8
00:00:55,640 --> 00:01:00,960
я могу достаточно безопасно сбросить последний коммит, верно?

9
00:01:00,960 --> 00:01:07,640
Если я сделаю git log, то рядом с хешем последнего коммита вы увидите head, что по сути

10
00:01:07,640 --> 00:01:10,240
указатель на последний коммит.

11
00:01:10,240 --> 00:01:17,320
Я вижу: это мой последний коммит, удалены какие-то строки логов, и я хочу это откатить.

12
00:01:17,320 --> 00:01:23,720
И я могу сделать это с помощью reset hard head.

13
00:01:23,720 --> 00:01:28,320
И здесь я указываю, сколько коммитов хочу сбросить.

14
00:01:28,320 --> 00:01:33,480
Так что если я хочу сбросить последние два или три коммита, я могу написать два или три

15
00:01:33,480 --> 00:01:34,480
здесь.

16
00:01:34,480 --> 00:01:37,200
Я просто хочу сбросить последний коммит.

17
00:01:37,200 --> 00:01:42,680
Поэтому я собираюсь сделать head тильда один.

18
00:01:42,680 --> 00:01:49,800
И теперь, если я сделаю git log, вы увидите, что последний коммит пропал, исчез.

19
00:01:49,800 --> 00:01:54,840
И текущий последний коммит — предыдущий.

20
00:01:54,840 --> 00:01:58,160
Так что если я сделаю status, изменения исчезли, верно?

21
00:01:58,160 --> 00:02:00,520
У меня теперь нет никаких изменений.

22
00:02:00,520 --> 00:02:03,520
И изменения, которые я сделал, были откатаны.

23
00:02:03,520 --> 00:02:08,520
У меня обратно эти две строки, как и было раньше, будто ничего не случилось.

24
00:02:08,520 --> 00:02:16,400
То есть опция hard здесь по сути разворачивает коммит и также отбрасывает изменения,

25
00:02:16,400 --> 00:02:18,160
которые были в коммите.

26
00:02:18,160 --> 00:02:24,200
Но что, если я не хотел просто откатить коммит, а хотел бы исправить сделанные изменения

27
00:02:24,200 --> 00:02:25,240
в нём.

28
00:02:25,240 --> 00:02:43,040
Итак, снова уберём строку здесь, сделаем это и снова закоммитим.

29
00:02:43,040 --> 00:02:44,040
И это закоммитим.

30
00:02:44,040 --> 00:02:47,560
И снова у меня новый коммит в логе.

31
00:02:47,560 --> 00:02:53,800
Допустим, я не хочу выбрасывать все изменения, когда откатываю коммит.

32
00:02:53,800 --> 00:02:55,280
Я хочу это поправить.

33
00:02:55,280 --> 00:03:01,480
Я понял, что мне всё ещё нужно сделать коммит и эти изменения, но я хочу что-то изменить

34
00:03:01,480 --> 00:03:05,200
или исправить что-то в своих изменениях и затем снова закоммитить.

35
00:03:05,200 --> 00:03:10,840
В таком случае я могу сделать reset head без hard.

36
00:03:10,840 --> 00:03:16,040
Это то же самое, что reset soft.

37
00:03:16,040 --> 00:03:18,280
Но soft — опция по умолчанию.

38
00:03:18,280 --> 00:03:25,400
Так что если я её не укажу, по умолчанию будет reset soft.

39
00:03:25,400 --> 00:03:36,240
Если я выполню и сделаю status, вы увидите, что изменение всё ещё здесь, но коммит пропал.

40
00:03:36,240 --> 00:03:41,360
То есть коммит был откатан, но я всё ещё имею изменения кода локально.

41
00:03:41,360 --> 00:03:45,800
Например, удаление последней строки было верным, но тут должно быть вот так.

42
00:03:45,800 --> 00:03:47,880
И теперь это правильно.

43
00:03:47,880 --> 00:03:58,480
И я могу снова добавить и закоммитить изменения.

44
00:03:58,480 --> 00:04:06,120
Теперь есть другой способ обновить коммит, последний коммит, который я сделал в своём локальном репозитории.

45
00:04:06,120 --> 00:04:13,320
Например, если позже я решу: эй, знаешь что, эту строку тоже нужно удалить

46
00:04:13,320 --> 00:04:14,320
здесь.

47
00:04:14,320 --> 00:04:15,920
Это один коммит.

48
00:04:15,920 --> 00:04:23,760
И это изменение на самом деле относится к предыдущему коммиту, где я говорил удалить какие-то длинные строки.

49
00:04:23,760 --> 00:04:30,880
Так что я добавляю эти изменения, и теперь могу сделать get commit amend.

50
00:04:30,880 --> 00:04:37,120
Так что это, вместо создания нового коммита, объединит то изменение или этот новый коммит в

51
00:04:37,120 --> 00:04:41,480
предыдущий в последний и внести в него изменения.

52
00:04:41,480 --> 00:04:51,640
Так что если я сделаю это, у меня уже есть описание последнего коммита, и я могу оставить его как есть

53
00:04:51,640 --> 00:04:55,720
и сохранить его.

54
00:04:55,720 --> 00:05:01,800
Он закоммичен, и если посмотреть логи, он объединён с последним коммитом.

55
00:05:01,800 --> 00:05:04,000
Новый коммит не создался.

56
00:05:04,000 --> 00:05:10,200
Теперь я могу отправить это в удалённый репозиторий.

57
00:05:10,200 --> 00:05:11,200
И всё.

58
00:05:11,440 --> 00:05:18,680
Допустим, я понял, что тот коммит был совершенно неправильным.

59
00:05:18,680 --> 00:05:23,920
Мне не следовало его делать, или он что-то сломал, и я понял: ладно, надо было сделать это

60
00:05:23,920 --> 00:05:26,080
по-другому.

61
00:05:26,080 --> 00:05:34,280
Теперь я могу просто откатить коммит локально с помощью git reset, потому что я уже отправил его

62
00:05:34,280 --> 00:05:36,080
в удалённый репозиторий.

63
00:05:36,080 --> 00:05:39,520
То есть изменение уже здесь.

64
00:05:39,520 --> 00:05:40,920
Что же мне теперь делать?

65
00:05:40,920 --> 00:05:47,040
Мне нужно изменить этот коммит, снова убрать несколько строк логов, прямо здесь.

66
00:05:47,040 --> 00:05:54,240
То есть я хочу добиться того, чтобы откатить или отменить коммит

67
00:05:54,240 --> 00:05:56,760
и в удалённом репозитории тоже.

68
00:05:56,760 --> 00:06:06,440
Сделать это можно через git reset head, как мы делали в прошлый раз.

69
00:06:06,440 --> 00:06:11,920
Я сделаю hard, потому что хочу отбросить все изменения.

70
00:06:11,920 --> 00:06:13,240
Я хочу отменить коммит.

71
00:06:13,240 --> 00:06:14,560
Хочу начать с нуля.

72
00:06:14,560 --> 00:06:20,600
Это удалит коммит.

73
00:06:20,600 --> 00:06:27,520
Теперь в моём локальном репозитории есть изменение, но в удалённом всё ещё есть этот коммит.

74
00:06:27,520 --> 00:06:30,040
Как же его удалить?

75
00:06:30,040 --> 00:06:37,280
Я могу сделать это с помощью git push --force.

76
00:06:37,280 --> 00:06:38,480
Почему force?

77
00:06:38,480 --> 00:06:46,080
Потому что мы создали изменение или откатили что-то, что в удалённом репозитории уже

78
00:06:46,080 --> 00:06:47,080
есть.

79
00:06:47,080 --> 00:06:53,300
Поэтому обычный git push не позволит нам отправить наши изменения.

80
00:06:53,300 --> 00:06:55,520
Давайте попробуем.

81
00:06:55,520 --> 00:07:02,400
И вот, мы не можем этого сделать, потому что у нас на один коммит меньше,

82
00:07:02,400 --> 00:07:04,560
чем у удалённой ветки.

83
00:07:04,560 --> 00:07:11,120
Поэтому нас просят обновить локальную ветку, чтобы получить последний коммит.

84
00:07:11,120 --> 00:07:15,360
Потому что сейчас, для git, мы отстаём от удалённого репозитория.

85
00:07:15,360 --> 00:07:17,760
Но мы знаем, что хотим переопределить это поведение.

86
00:07:17,760 --> 00:07:22,400
Мы хотим удалить и тот удалённый коммит.

87
00:07:22,400 --> 00:07:23,880
Мы, по сути, знаем, что делаем.

88
00:07:23,880 --> 00:07:27,480
Поэтому в этом случае мы можем применить поведение force.

89
00:07:27,480 --> 00:07:36,720
Если я сделаю git push force, он всё равно протолкнёт наши изменения в удалённый репозиторий.

90
00:07:36,720 --> 00:07:43,920
А теперь, если вернуться и обновить, видно, что коммит исчез.

91
00:07:43,920 --> 00:07:48,080
То есть мы перезаписали коммит в удалённом репозитории.

92
00:07:48,080 --> 00:07:52,280
Теперь здесь очень-очень важное замечание.

93
00:07:52,280 --> 00:07:58,600
А именно: не делайте этого в ветке develop или master или в ветке, над которой работают

94
00:07:58,600 --> 00:08:02,240
многие люди, много других разработчиков.

95
00:08:02,240 --> 00:08:03,240
Почему?

96
00:08:03,240 --> 00:08:08,800
Потому что, допустим, вы добавили новый коммит, отправили его в удалённый репозиторий

97
00:08:08,800 --> 00:08:13,880
и два других разработчика вытянули ваш коммит.

98
00:08:13,880 --> 00:08:22,480
Теперь вы принудительно удалили этот коммит из удалённого репозитория, так что его больше нет.

99
00:08:22,480 --> 00:08:28,800
И что теперь произойдёт, когда те двое разработчиков, у которых есть этот коммит,

100
00:08:28,800 --> 00:08:36,000
который вы только что убрали из удалённого репозитория, попробуют добавить свои изменения

101
00:08:36,000 --> 00:08:43,720
к ветке, у них возникнет проблема, потому что теперь изменения в их ветке не будут приняты

102
00:08:43,720 --> 00:08:45,920
удалённым репозиторием.

103
00:08:45,920 --> 00:08:52,240
Поэтому, когда они попытаются выполнить push, Git пожалуется, что что-то не так, что ссылка

104
00:08:52,240 --> 00:08:56,000
там отсутствует и история по сути нарушена.

105
00:08:56,000 --> 00:09:00,320
Поэтому не стоит делать это в ветке, в которой, как вы знаете, работают и другие люди,

106
00:09:00,320 --> 00:09:04,720
потому что вы, так сказать, сломаете их соединение с Git.

107
00:09:04,720 --> 00:09:10,720
И, конечно, это можно исправить и решить, но им придётся приложить

108
00:09:10,720 --> 00:09:11,720
усилия.

109
00:09:11,720 --> 00:09:15,640
Однако вы можете сделать это, если работаете в функциональной или багфикс-ветке, где

110
00:09:15,640 --> 00:09:20,960
есть только вы, вы единственный, кто вносит изменения, потому что тогда вы можете просто перезаписать

111
00:09:20,960 --> 00:09:22,300
коммит.

112
00:09:22,300 --> 00:09:29,000
Так что является альтернативой откату или сбросу коммита, например, в ветке master

113
00:09:29,000 --> 00:09:31,240
или develop?

114
00:09:31,240 --> 00:09:34,560
Альтернатива этому — revert.

115
00:09:34,560 --> 00:09:36,720
То есть есть git revert.

116
00:09:36,720 --> 00:09:42,640
Давайте перейдём в ветку master и внесём здесь изменение.

117
00:09:42,640 --> 00:09:45,000
Давайте удалим последний файл.

118
00:09:45,000 --> 00:09:49,520
Добавим это и закоммитим.

119
00:09:49,520 --> 00:09:59,560
Давайте просто сделаем тест и push.

120
00:09:59,560 --> 00:10:06,260
И теперь в ветке master есть новый коммит, и допустим, в этом одном коммите много

121
00:10:06,260 --> 00:10:07,500
изменений в коде, верно?

122
00:10:07,500 --> 00:10:14,000
Так что на то, чтобы пройти по каждому файлу и отменить изменения, уйдёт действительно много

123
00:10:14,000 --> 00:10:15,860
времени, а потом мы снова коммитим.

124
00:10:15,860 --> 00:10:20,140
Вместо этого мы просто хотим откатить этот конкретный коммит.

125
00:10:20,140 --> 00:10:24,600
То есть всё, что внутри, все изменения, мы просто хотим их откатить.

126
00:10:24,600 --> 00:10:31,700
Способ сделать это — выполнить команду git revert, и для git revert нам на самом деле нужен

127
00:10:31,700 --> 00:10:36,900
ID коммита или хэш коммита, который мы хотим откатить.

128
00:10:36,900 --> 00:10:40,560
И получить хэш коммита можно здесь с помощью git log.

129
00:10:40,560 --> 00:10:44,940
Вот хэш коммита, или мы можем получить его из интерфейса.

130
00:10:44,940 --> 00:10:47,180
Вот то же самое здесь.

131
00:10:47,180 --> 00:10:58,260
Так что скопируем его и выполним git revert с ID коммита, который мы откатываем.

132
00:10:58,260 --> 00:11:01,420
Сообщение коммита автоматически содержит слово revert.

133
00:11:01,420 --> 00:11:16,300
Это сообщение коммита того коммита, который мы откатываем, и если я запушу это и обновлю, вы увидите revert.

134
00:11:16,300 --> 00:11:19,380
То есть он не перезаписывает коммит.

135
00:11:19,380 --> 00:11:25,900
Он создаёт новый коммит, который включает изменения в коде, фактически противоположные

136
00:11:25,900 --> 00:11:29,860
тому, что делают эти изменения кода.

137
00:11:29,860 --> 00:11:36,260
И если я зайду внутрь, вы увидите, что в server.js строка, которую мы удалили, была возвращена.

